<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <script 
        src="https://unpkg.com/rxjs@6.5/bundles/rxjs.umd.min.js"></script>
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>

        <div style="padding:20px">
          <input
          id="text-box"
          type="text"
          placeholder="Search suggestion name"
          style="width:300px;padding: 5px;font-size:15px"/>
          <div id=result>


        </div>

          <script>
            const {
              fromEvent,
              from,
              merge,
              zip,
              combineAll
            } = rxjs

            const {
              map,
              filter,
              debounceTime,
              switchMap,
              first,
              take,
              tap,
              concatAll,
              toArray,
              distinct
            } = rxjs.operators

            const DELAY                   = 750
            const MINIMUM_WORD_TO_EXECUTE = 3
            const KEYCODE_BACKSPACE       = 8
            const TOKEN                   = 'Z1PQI0Bd708LULX921hamUDxbsyh9Df63DYE'

            const textBox   = document.getElementById('text-box')
            const divResult = document.getElementById('result')

            const searchName = (name) => {
              const url = `https://gorest.co.in/public-api/users?access-token=${TOKEN}`
              const opts = {
                url: url,
                method: "get",
                headers: {
                  'Content-Type': 'application/json'
                },
                params: {
                  first_name: name,
                  _format: "json",
                }
              }
              return axios(opts)
            }

            const getValueFromApi = (e) => {
              return from(searchName(e.target.value))
                    .pipe(
                      switchMap((res) =>
                        from(res.data.result)
                          .pipe(
                            take(5)
                          )
                      ),
                    )
            }

            const whenPressBackspace = fromEvent(textBox, 'keydown')
              .pipe(
                filter(e => e.keyCode === KEYCODE_BACKSPACE),
                debounceTime(DELAY),
                tap(() => divResult.innerHTML = "")
              )

            const keywordCountEqualandMoreMinimum = fromEvent(textBox, 'keyup')
              .pipe(
                debounceTime(DELAY),
                filter(e => e.target.value !== "" && e.target.value.length >= MINIMUM_WORD_TO_EXECUTE),
                tap(() => divResult.innerHTML = ""),
                switchMap((e) => {
                    return zip(getValueFromApi(e), getValueFromApi(e)).pipe(
                      concatAll(),
                      map((res) =>{
                        if(res.first_name) return res.first_name
                        
                      }),
                      toArray()
                    )
                  }
                ),
                switchMap((arrayResult) => {
                  return from(arrayResult).pipe(
                    distinct()
                  )
                })
              )

            const observable = merge(
              whenPressBackspace,
              keywordCountEqualandMoreMinimum
            )
            observable.subscribe(
              val => {
                if(typeof(val) === "string") divResult.innerHTML += `<p>${val}</p>`
              }
            )

        </script>
    </body>
</html>